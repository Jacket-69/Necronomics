---
phase: 05-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/dashboard/HeroBalance.tsx
  - src/components/dashboard/IncomeExpensePanel.tsx
  - src/components/dashboard/TopCategoriesPanel.tsx
  - src/components/dashboard/RecentTransactionsPanel.tsx
  - src/pages/DashboardPage.tsx
  - src/App.tsx
autonomous: true
requirements:
  - DASH-01
  - DASH-02
  - DASH-03
  - DASH-04

must_haves:
  truths:
    - "User sees consolidated total balance in hero section at top of dashboard"
    - "User sees per-account balances below consolidated total in hero section"
    - "User sees current-month income and expense with net result color-coded green/red"
    - "User sees top 5 spending categories with horizontal proportion bars"
    - "User sees 10 most recent transactions in compact table format"
    - "Dashboard is accessible at /dashboard and is the home page (/ redirects to /dashboard)"
    - "Dashboard link appears as first item in navigation bar"
  artifacts:
    - path: "src/components/dashboard/HeroBalance.tsx"
      provides: "Full-width hero balance section with consolidated total and per-account row"
      min_lines: 30
    - path: "src/components/dashboard/IncomeExpensePanel.tsx"
      provides: "Income vs expense panel with net result"
      min_lines: 30
    - path: "src/components/dashboard/TopCategoriesPanel.tsx"
      provides: "Top 5 categories with horizontal bars"
      min_lines: 40
    - path: "src/components/dashboard/RecentTransactionsPanel.tsx"
      provides: "Last 10 transactions compact table with Ver todas link"
      min_lines: 40
    - path: "src/pages/DashboardPage.tsx"
      provides: "Dashboard page assembling all panels"
      min_lines: 40
    - path: "src/App.tsx"
      provides: "Updated routing with /dashboard route and nav link"
      contains: "DashboardPage"
  key_links:
    - from: "src/pages/DashboardPage.tsx"
      to: "src/lib/tauri.ts"
      via: "dashboardApi.getData()"
      pattern: "dashboardApi\\.getData"
    - from: "src/App.tsx"
      to: "src/pages/DashboardPage.tsx"
      via: "Route element"
      pattern: "Route.*path.*dashboard.*DashboardPage"
    - from: "src/App.tsx"
      to: "/dashboard"
      via: "Navigate redirect"
      pattern: "Navigate.*to.*dashboard"
---

<objective>
Build the dashboard UI page with four data panels matching the locked layout decisions, and wire routing so the dashboard becomes the app's home page.

Purpose: Deliver the visual dashboard that users see — the culmination of all dashboard requirements.
Output: 4 panel components, DashboardPage, updated App.tsx routing and navigation.
</objective>

<execution_context>
@/home/jacket/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/jacket/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard/05-CONTEXT.md
@.planning/phases/05-dashboard/05-01-SUMMARY.md

@src/App.tsx
@src/types/index.ts
@src/lib/tauri.ts
@src/lib/formatters.ts
@src/lib/hooks.ts
@src/pages/TransactionsPage.tsx
@src/components/transactions/BalanceSummary.tsx
@src/styles/globals.css

<interfaces>
<!-- Types from Plan 01 that this plan consumes -->

From src/types/index.ts (added by Plan 01):

```typescript
export interface DashboardData {
  balanceSummary: BalanceSummary;
  monthlyIncomeExpense: MonthlyIncomeExpense;
  topCategories: CategorySpending[];
  recentTransactions: RecentTransaction[];
}

export interface MonthlyIncomeExpense {
  income: number;
  expense: number;
  monthName: string;
  year: number;
}

export interface CategorySpending {
  categoryId: string;
  categoryName: string;
  amount: number;
  percentage: number;
}

export interface RecentTransaction {
  id: string;
  accountName: string;
  categoryName: string;
  amount: number;
  transactionType: string;
  description: string;
  date: string;
  currencyCode: string;
}
```

From src/lib/tauri.ts (added by Plan 01):

```typescript
export const dashboardApi = {
  getData: (): Promise<DashboardData> => invoke("get_dashboard_data"),
};
```

From src/types/index.ts (existing):

```typescript
export interface BalanceSummary {
  accounts: AccountBalance[];
  consolidatedTotal: number | null;
  baseCurrencyCode: string;
}
export interface AccountBalance {
  accountId: string;
  accountName: string;
  balance: number;
  currencyCode: string;
}
```

From src/lib/formatters.ts (existing):

```typescript
export const formatCurrency = (minorUnits: number, currencyCode: string): string => { ... }
```

From src/App.tsx (existing nav/route structure):

```typescript
const navLinks = [
  { to: "/accounts", label: "Cuentas" },
  { to: "/categories", label: "Categorias" },
  { to: "/transactions", label: "Transacciones" },
  { to: "/debts", label: "Deudas" },
];
// Route: <Route path="/" element={<Navigate to="/accounts" replace />} />
```

</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard panel components</name>
  <files>
    src/components/dashboard/HeroBalance.tsx
    src/components/dashboard/IncomeExpensePanel.tsx
    src/components/dashboard/TopCategoriesPanel.tsx
    src/components/dashboard/RecentTransactionsPanel.tsx
  </files>
  <action>
Create `src/components/dashboard/` directory with 4 panel components. All components use the established theme: dark backgrounds (#0a0f06, #111a0a), green borders (#2a3518), green accent (#7fff00, #4a5d23), Cinzel Decorative for headings, Share Tech Mono for UI text, JetBrains Mono for financial numbers. Import `formatCurrency` from `../../lib/formatters` for all money display.

**1. `HeroBalance.tsx`** — Full-width hero section (DASH-01)

Props: `{ balanceSummary: BalanceSummary }` (import BalanceSummary, AccountBalance from types).

Layout (per user decision):

- Spans full width at top of dashboard
- Large consolidated total in base currency prominently displayed (use `formatCurrency(summary.consolidatedTotal, summary.baseCurrencyCode)`)
- If `consolidatedTotal` is null, show "—" with tooltip "Tipo de cambio no disponible"
- Below the total: a compact horizontal row of per-account balances, each showing `accountName: formattedBalance`
- If many accounts (>4), allow horizontal scroll with `overflow-x: auto` and `flex-nowrap`
- Style: panel container with `backgroundColor: "#111a0a"`, `borderColor: "#2a3518"`, rounded border
- Consolidated total font: JetBrains Mono, large size (~24px), color #c4d4a0
- A small "Balance Total" label above the number in Share Tech Mono, color #6b7c3e
- Per-account items use Share Tech Mono, smaller (~13px), color #6b7c3e for name, #c4d4a0 for amount

Loading state: Show a skeleton placeholder (simple pulsing div with `animate-pulse` Tailwind class) when data is undefined/null.
Empty state: If no accounts, show subtle message "Sin cuentas registradas".

**2. `IncomeExpensePanel.tsx`** — Monthly income vs expense (DASH-02)

Props: `{ data: MonthlyIncomeExpense; baseCurrencyCode: string }`.

Layout (per user decision):

- Panel title: "{monthName} {year}" (e.g., "Marzo 2026") — use Cinzel Decorative or Share Tech Mono bold, color #c4d4a0
- Two numbers side by side:
  - Left: "Ingresos" label above, income amount below (formatted with baseCurrencyCode)
  - Right: "Gastos" label above, expense amount below (formatted with baseCurrencyCode)
- Below both: net result line "Neto: {formatted}" — color-coded: `#7fff00` (green) if >= 0, `#ff4444` (red) if < 0
- Labels in Share Tech Mono, ~12px, color #6b7c3e
- Amounts in JetBrains Mono, ~16px, color #c4d4a0
- Panel container: same dark border style as other panels, fixed height to match sibling panels
- Loading state: animate-pulse skeleton
- Empty state (both income and expense are 0): show zeros, not a special message

**3. `TopCategoriesPanel.tsx`** — Top spending categories (DASH-03)

Props: `{ categories: CategorySpending[]; baseCurrencyCode: string }`.

Layout (per user decision):

- Panel title: "Top Gastos" or "Categorias" in Share Tech Mono bold, color #c4d4a0
- Each entry (up to 5 + "Otros"): category name on the left, amount on the right, horizontal bar below showing proportion of total spending
- Horizontal bars: use a div with `backgroundColor: "#4a5d23"` as the track and a child div with `backgroundColor: "#7fff00"` as the fill, width = `percentage%`
- Bar height: ~6px, rounded-full
- Entries ranked highest to lowest (already sorted by backend)
- Category name: Share Tech Mono, ~13px, color #c4d4a0
- Amount: JetBrains Mono, ~13px, color #6b7c3e, right-aligned
- Formatted with baseCurrencyCode via `formatCurrency(amount, baseCurrencyCode)`
- Loading state: animate-pulse skeleton bars
- Empty state: "Sin gastos este mes" in muted text

**4. `RecentTransactionsPanel.tsx`** — Recent transactions (DASH-04)

Props: `{ transactions: RecentTransaction[] }`.

Layout (per user decision):

- Panel title: "Transacciones Recientes" in Share Tech Mono bold, color #c4d4a0
- Up to 10 compact table rows
- Each row shows: date (formatted as DD/MM), amount + type indicator (green for income, red for expense), category name, account name, description (truncated with ellipsis if long)
- Use `formatCurrency(txn.amount, txn.currencyCode)` for amount
- Prefix amount with "+" for income, "-" for expense
- Amount color: income = #7fff00, expense = #ff4444
- Row styling: compact (py-1.5), alternating subtle background or border-bottom separator (#1a2510)
- Font: Share Tech Mono ~12px for text, JetBrains Mono ~12px for amounts
- At bottom: "Ver todas" link in #7fff00 that navigates to `/transactions` — use `<Link to="/transactions">` from react-router
- Loading state: animate-pulse skeleton rows
- Empty state: "Sin transacciones registradas" in muted text
- This panel is wider (50% in the 3-panel row) because it holds tabular data per user decision

All components are functional arrow functions with named exports. One component per file. No `any` types.
</action>
<verify>
<automated>npx tsc --noEmit 2>&1 | tail -10</automated>
</verify>
<done> - 4 panel components exist in src/components/dashboard/ - HeroBalance renders consolidated total + per-account balances - IncomeExpensePanel shows income, expense, and color-coded net - TopCategoriesPanel shows top 5 + Otros with horizontal bars - RecentTransactionsPanel shows 10 recent transactions with Ver todas link - All components handle loading and empty states - TypeScript compiles without errors
</done>
</task>

<task type="auto">
  <name>Task 2: DashboardPage and route wiring</name>
  <files>
    src/pages/DashboardPage.tsx
    src/App.tsx
  </files>
  <action>
**1. Create `src/pages/DashboardPage.tsx`:**

Follow the established page pattern (see TransactionsPage, DebtsPage):

- Import `{ useEffect, useState, useCallback }` from React
- Import `{ dashboardApi }` from lib/tauri
- Import `{ formatCurrency }` from lib/formatters
- Import all 4 panel components from components/dashboard/
- Import `DashboardData` from types

State:

```typescript
const [data, setData] = useState<DashboardData | null>(null);
const [isLoading, setIsLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```

Data fetching:

```typescript
const fetchDashboard = useCallback(async () => {
  setIsLoading(true);
  setError(null);
  try {
    const result = await dashboardApi.getData();
    setData(result);
  } catch (err) {
    setError(err instanceof Error ? err.message : String(err));
  } finally {
    setIsLoading(false);
  }
}, []);

useEffect(() => {
  fetchDashboard();
}, [fetchDashboard]);
```

Layout (per user decisions):

```
<div className="p-4 max-w-7xl mx-auto">
  {/* Page title - optional since dashboard is self-explanatory */}

  {/* Error state - full page */}
  {error && <error banner>}

  {/* Hero balance - full width */}
  <HeroBalance balanceSummary={data?.balanceSummary} />

  {/* 3-panel row below hero */}
  <div className="grid grid-cols-4 gap-4 mt-4">
    {/* Left 25%: Income vs Expense */}
    <div className="col-span-1">
      <IncomeExpensePanel
        data={data?.monthlyIncomeExpense}
        baseCurrencyCode={data?.balanceSummary?.baseCurrencyCode ?? "CLP"}
      />
    </div>

    {/* Center 25%: Top Categories */}
    <div className="col-span-1">
      <TopCategoriesPanel
        categories={data?.topCategories}
        baseCurrencyCode={data?.balanceSummary?.baseCurrencyCode ?? "CLP"}
      />
    </div>

    {/* Right 50%: Recent Transactions */}
    <div className="col-span-2">
      <RecentTransactionsPanel transactions={data?.recentTransactions} />
    </div>
  </div>
</div>
```

Make props optional (accept `undefined`) so panels can show loading skeletons while data loads. Each panel handles its own loading state internally when its prop is undefined.

Error state: If the API call fails, show a full-width error banner with the error message and a "Reintentar" button that calls `fetchDashboard()`. Style: border-red, bg-red-900/20, text red.

Named export: `export const DashboardPage = () => { ... }`

**2. Update `src/App.tsx`:**

a) Add import:

```typescript
import { DashboardPage } from "./pages/DashboardPage";
```

b) Add "Dashboard" as the FIRST item in `navLinks` array (per user decision):

```typescript
const navLinks = [
  { to: "/dashboard", label: "Dashboard" },
  { to: "/accounts", label: "Cuentas" },
  { to: "/categories", label: "Categorias" },
  { to: "/transactions", label: "Transacciones" },
  { to: "/debts", label: "Deudas" },
];
```

c) Change the `/` redirect from `/accounts` to `/dashboard`:

```typescript
<Route path="/" element={<Navigate to="/dashboard" replace />} />
```

d) Add the `/dashboard` route:

```typescript
<Route path="/dashboard" element={<DashboardPage />} />
```

Place it after the `/` redirect and before `/accounts`.

Do NOT add `Link` import to App.tsx — it already uses `NavLink` from react-router.
</action>
<verify>
<automated>npx tsc --noEmit 2>&1 | tail -10</automated>
</verify>
<done> - DashboardPage.tsx exists and fetches data via dashboardApi.getData() - DashboardPage renders HeroBalance, IncomeExpensePanel, TopCategoriesPanel, RecentTransactionsPanel in correct grid layout (25/25/50) - App.tsx has /dashboard route rendering DashboardPage - App.tsx / redirects to /dashboard (not /accounts) - App.tsx navLinks has "Dashboard" as first item - Loading, error, and empty states handled - TypeScript compiles without errors
</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` completes successfully
- App.tsx imports DashboardPage and routes / to /dashboard
- Nav bar shows "Dashboard" as first link
- DashboardPage calls dashboardApi.getData() and passes data to all 4 panels
- All panels import formatCurrency for money display
- RecentTransactionsPanel has Link to /transactions
</verification>

<success_criteria>

- Dashboard page renders at /dashboard with all 4 data panels
- Hero section spans full width with consolidated total and per-account balances
- Income/expense panel shows current month name in Spanish, net color-coded green/red
- Top categories panel shows up to 5 + Otros with horizontal proportion bars in #4a5d23/#7fff00
- Recent transactions panel shows 10 rows with date, amount, category, account, description
- "Ver todas" link navigates to /transactions
- Dashboard is home page (/ redirects to /dashboard)
- "Dashboard" is first nav bar item
  </success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard/05-02-SUMMARY.md`
</output>
