---
phase: 01-accounts
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/stores/accountStore.ts
  - src/App.tsx
  - src/main.tsx
  - src/pages/AccountsPage.tsx
  - src/components/accounts/AccountList.tsx
  - src/components/accounts/AccountRow.tsx
  - src/components/accounts/AccountCard.tsx
autonomous: true
requirements:
  - ACCT-04

must_haves:
  truths:
    - "User can view a list of accounts with current balance displayed per account"
    - "Account list is sorted by account type then account name"
    - "Balance is displayed right-aligned with currency symbol and correct decimal formatting"
    - "React router navigates between /accounts and /accounts/new routes"
  artifacts:
    - path: "src/stores/accountStore.ts"
      provides: "Zustand store for account state management"
      exports: ["useAccountStore"]
    - path: "src/pages/AccountsPage.tsx"
      provides: "Accounts list page with fetch-on-mount"
      exports: ["AccountsPage"]
    - path: "src/components/accounts/AccountList.tsx"
      provides: "Desktop table + mobile card layout for accounts"
      exports: ["AccountList"]
    - path: "src/components/accounts/AccountRow.tsx"
      provides: "Single account row for desktop table"
      exports: ["AccountRow"]
    - path: "src/components/accounts/AccountCard.tsx"
      provides: "Single account card for mobile layout"
      exports: ["AccountCard"]
  key_links:
    - from: "src/stores/accountStore.ts"
      to: "src/lib/tauri.ts"
      via: "accountApi calls inside store actions"
      pattern: "accountApi\\."
    - from: "src/pages/AccountsPage.tsx"
      to: "src/stores/accountStore.ts"
      via: "useAccountStore hook"
      pattern: "useAccountStore"
    - from: "src/components/accounts/AccountList.tsx"
      to: "src/lib/formatters.ts"
      via: "formatCurrency for balance display"
      pattern: "formatCurrency"
    - from: "src/App.tsx"
      to: "src/pages/AccountsPage.tsx"
      via: "react-router route definition"
      pattern: "AccountsPage"
---

<objective>
Build the Zustand account store, set up React Router, and implement the accounts list page with desktop table and mobile card layouts.

Purpose: Make account data accessible in the UI and establish the navigation skeleton that all subsequent phases will build on.
Output: A working accounts list page at `/accounts` showing all active accounts with formatted balances, accessible via React Router.
</objective>

<execution_context>
@/home/jacket/.claude/get-shit-done/workflows/execute-plan.md
@/home/jacket/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-accounts/01-CONTEXT.md
@.planning/phases/01-accounts/01-RESEARCH.md
@.planning/phases/01-accounts/01-01-SUMMARY.md

<interfaces>
<!-- From Plan 01 outputs — types and API wrappers the executor needs -->

From src/types/index.ts:
```typescript
export type AccountType = 'cash' | 'bank' | 'credit_card';

export interface Account {
  id: string;
  name: string;
  type: AccountType;
  currencyId: string;
  balance: number;
  creditLimit: number | null;
  billingDay: number | null;
  isActive: number;
  createdAt: string;
}

export interface CreateAccountInput {
  name: string;
  accountType: AccountType;
  currencyId: string;
  creditLimit?: number;
  billingDay?: number;
}

export interface UpdateAccountInput {
  name?: string;
  currencyId?: string;
  creditLimit?: number;
  billingDay?: number;
}

export interface Currency {
  id: string;
  code: string;
  name: string;
  symbol: string;
  decimalPlaces: number;
}
```

From src/lib/tauri.ts:
```typescript
export const accountApi = {
  list: (): Promise<Account[]>,
  get: (id: string): Promise<Account>,
  create: (input: CreateAccountInput): Promise<Account>,
  update: (id: string, input: UpdateAccountInput): Promise<Account>,
  archive: (id: string): Promise<void>,
  delete: (id: string): Promise<void>,
};

export const currencyApi = {
  list: (): Promise<Currency[]>,
};
```

From src/lib/formatters.ts:
```typescript
export const formatCurrency = (minorUnits: number, currencyCode: string): string;
export const formatAccountType = (type: string): string;
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zustand account store</name>
  <files>
    src/stores/accountStore.ts
  </files>
  <action>
Create `src/stores/accountStore.ts` using Zustand v5 `create` API (no middleware needed for Phase 1).

The store must manage:
- `accounts: Account[]` — the list of active accounts
- `currencies: Currency[]` — the list of available currencies (for dropdowns)
- `isLoading: boolean` — loading state for async operations
- `error: string | null` — last error message

Actions (all async, calling accountApi and currencyApi from `src/lib/tauri.ts`):
- `fetchAccounts()` — set loading true, call `accountApi.list()`, set accounts + loading false. On error, set error string.
- `fetchCurrencies()` — call `currencyApi.list()`, set currencies. Used by the account form for currency dropdown.
- `addAccount(input: CreateAccountInput): Promise<Account>` — call `accountApi.create(input)`, optimistically add to accounts array, return the created account. On error, refetch and rethrow.
- `updateAccount(id: string, input: UpdateAccountInput): Promise<Account>` — call `accountApi.update(id, input)`, replace in accounts array, return updated account. On error, refetch and rethrow.
- `archiveAccount(id: string): Promise<void>` — call `accountApi.archive(id)`, remove from accounts array (since list only shows active). On error, refetch and rethrow.
- `deleteAccount(id: string): Promise<void>` — call `accountApi.delete(id)`, remove from accounts array. On error, refetch and rethrow.

**Pattern:** Use `set((state) => ({ accounts: [...state.accounts, newAccount] }))` for immutable updates.

**Error handling pattern:**
```typescript
try {
  const result = await accountApi.create(input);
  set((state) => ({ accounts: [...state.accounts, result] }));
  return result;
} catch (e) {
  // Refetch to ensure consistency after failed optimistic update
  await get().fetchAccounts();
  throw e;
}
```

Export the hook as `useAccountStore`.
  </action>
  <verify>
    <automated>cd /home/jacket/PROYECTOS/PERSONALES/Necronomics && npx tsc --noEmit src/stores/accountStore.ts</automated>
  </verify>
  <done>
    - src/stores/accountStore.ts exports useAccountStore
    - Store has accounts, currencies, isLoading, error state
    - All 6 actions (fetch, add, update, archive, delete accounts + fetch currencies) are implemented
    - Error handling refetches on failure to maintain consistency
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up React Router and build accounts list page</name>
  <files>
    src/App.tsx
    src/main.tsx
    src/pages/AccountsPage.tsx
    src/components/accounts/AccountList.tsx
    src/components/accounts/AccountRow.tsx
    src/components/accounts/AccountCard.tsx
  </files>
  <action>
**Step 1: Set up React Router in `src/App.tsx` and `src/main.tsx`.**

Update `src/main.tsx` to wrap the app with `BrowserRouter`:
```typescript
import { BrowserRouter } from 'react-router';
// Wrap <App /> with <BrowserRouter>
```

Update `src/App.tsx` to use `Routes` and `Route` from react-router:
- Route `/` redirects to `/accounts` (use `Navigate` component)
- Route `/accounts` renders `AccountsPage`
- Route `/accounts/new` — placeholder for Plan 03 (render a simple div with "Nueva cuenta" text)
- Route `/accounts/:id/edit` — placeholder for Plan 03

Keep the dark background style (`backgroundColor: "#0a0f06"`) as a wrapper around the Routes. This is a minimal app shell — no sidebar or header yet (Phase 8).

**Step 2: Create `src/pages/AccountsPage.tsx`.**

This is the main accounts list page. It must:
- Call `useAccountStore` to get `accounts`, `isLoading`, `error`, `fetchAccounts`
- Call `fetchAccounts()` on mount via `useEffect`
- Show loading state while fetching (a simple "Cargando cuentas..." text)
- Show error state if fetch fails (error message in red)
- Show empty state if no accounts ("No hay cuentas. Crea una para comenzar.")
- Render `AccountList` component when accounts exist
- Include a "Nueva cuenta" button that navigates to `/accounts/new` via `useNavigate()`
- Page title: "Cuentas"

Use TailwindCSS v4 classes for styling. The page should use the project's dark theme:
- Background: inherit from App shell
- Text color: `#a8b878` (moss green) for body text
- Title: `#c4d4a0` (light moss) with Cinzel Decorative font
- Button: `#4a5d23` background with `#7fff00` (chartreuse) text on hover

**Step 3: Create `src/components/accounts/AccountList.tsx`.**

Receives `accounts: Account[]` as prop. Per CONTEXT.md decisions:
- **Desktop (>= 768px):** Dense table layout with columns: Nombre, Tipo, Moneda, Saldo, Acciones
- **Mobile (< 768px):** Stacked cards layout
- Use Tailwind responsive classes (`hidden md:table` / `md:hidden`) for breakpoint switching
- Default sort is by account type then name (already sorted by backend query, so no client-side sorting needed)
- Balance column: right-aligned, strong visual emphasis (larger font weight, `font-mono` for numbers)
- Currency symbol displayed with balance (use `formatCurrency` from `src/lib/formatters.ts`)
- Account type displayed using `formatAccountType` (Spanish labels)
- Actions column: Edit and Archive buttons (inline). These buttons will wire to real functionality in Plan 03; for now, render the buttons but have them call placeholder functions that log to console.

**Step 4: Create `src/components/accounts/AccountRow.tsx`.**

Single table row component. Props: `account: Account`, `onEdit: (id: string) => void`, `onArchive: (id: string) => void`.
- Renders one `<tr>` with cells for name, type (Spanish label), currency code, balance (formatted, right-aligned, `font-mono`), and action buttons.
- Edit button: text "Editar", navigates to `/accounts/{id}/edit` or calls onEdit
- Archive button: text "Archivar", calls onArchive

**Step 5: Create `src/components/accounts/AccountCard.tsx`.**

Mobile card component. Props: same as AccountRow.
- Card-style layout with account name as title, type badge, currency, and balance prominently displayed
- Action buttons at bottom of card
- Use dark card background (`#111a0a` or similar dark green tint) with subtle border

**UI language:** All labels in Spanish (per CLAUDE.md). Examples: "Nombre", "Tipo", "Moneda", "Saldo", "Acciones", "Editar", "Archivar", "Nueva cuenta".

**Styling:** Use TailwindCSS classes. For number display, use `font-mono` class to use JetBrains Mono (or monospace fallback). For headings use Cinzel Decorative font family. For body text use Share Tech Mono.
  </action>
  <verify>
    <automated>cd /home/jacket/PROYECTOS/PERSONALES/Necronomics && npx tsc --noEmit && npm run build 2>&1 | head -30</automated>
  </verify>
  <done>
    - React Router configured with /accounts route rendering AccountsPage
    - AccountsPage fetches accounts on mount and displays them via AccountList
    - AccountList renders a desktop table (>= 768px) and mobile cards (< 768px)
    - Balance displayed right-aligned with currency symbol using formatCurrency
    - Account types displayed in Spanish via formatAccountType
    - Loading, error, and empty states handled in AccountsPage
    - "Nueva cuenta" button navigates to /accounts/new
    - TypeScript compiles and Vite builds without errors
    - All UI text is in Spanish
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes — all TypeScript compiles
2. `npm run build` passes — Vite production build succeeds
3. AccountsPage renders at /accounts route
4. Store correctly calls accountApi.list() and populates accounts
5. Desktop table shows columns: Nombre, Tipo, Moneda, Saldo, Acciones
6. Mobile cards show account details in card layout
7. Balance uses formatCurrency with correct currency symbol and decimal places
</verification>

<success_criteria>
- Zustand store fully typed with all CRUD actions
- React Router routes defined for /accounts, /accounts/new, /accounts/:id/edit
- Accounts list page fetches and displays accounts on mount
- Desktop table layout and mobile card layout both render correctly
- Formatted currency display matches: CLP no decimals, USD/EUR/CNY 2 decimals, JPY no decimals
- All UI text in Spanish
</success_criteria>

<output>
After completion, create `.planning/phases/01-accounts/01-02-SUMMARY.md`
</output>
